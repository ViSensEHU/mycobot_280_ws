<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="erobotics_myCobot280_arduino">

  <!-- Argumentos de Xacro para configuración dinámica -->
  <xacro:arg name="use_gripper" default="true" />
  <xacro:arg name="use_camera" default="false" />

  <!-- Propiedades globales -->
  <xacro:property name="mesh_path" value="package://erobotics_description/meshes" />
  <xacro:property name="width" value=".2" />
  <xacro:property name="default_mass" value="0.1" />

  <!-- Incluir configuración de Gazebo y el archivo de la Pinza -->
  <xacro:include filename="erobotics_ros2_control.xacro" />
  <xacro:include filename="adaptative_gripper.urdf.xacro" />
  <xacro:include filename="rgb_camera.xacro" />

  <!-- Macro para inercias por defecto -->
  <xacro:macro name="m_inertial_default" params="mass origin_xyz origin_rpy">
    <inertial>
      <mass value="${mass}" />
      <origin xyz="${origin_xyz}" rpy="${origin_rpy}" />
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001" />
    </inertial>
  </xacro:macro>

  <!-- Macro para eslabones -->
  <xacro:macro name="m_link_mesh" params="name mesh_file origin_xyz origin_rpy mass:=${default_mass}">
    <link name="${name}">
      <visual>
        <geometry><mesh filename="${mesh_path}/${mesh_file}"/></geometry>
        <origin xyz="${origin_xyz}" rpy="${origin_rpy}"/>
      </visual>
      <collision>
        <geometry><mesh filename="${mesh_path}/${mesh_file}"/></geometry>
        <origin xyz="${origin_xyz}" rpy="${origin_rpy}"/>
      </collision>
      <xacro:m_inertial_default mass="${mass}" origin_xyz="${origin_xyz}" origin_rpy="${origin_rpy}" />
    </link>
  </xacro:macro>

  <!-- Cuerpo del Robot (Base y Brazo) -->
  <link name="world"/>


  <link name="g_base">
    <visual>
      <geometry><mesh filename="${mesh_path}/G_base.dae"/></geometry>
      <origin xyz="-0.01 0 -0.032" rpy="0 0 1.5708"/>
    </visual>
    <collision>
      <geometry><mesh filename="${mesh_path}/G_base.dae"/></geometry>
      <origin xyz="0.0 0 -0.032" rpy="0 0 1.5708"/>
    </collision>
    <xacro:m_inertial_default mass="${default_mass}" origin_xyz="0 0 -0.032" origin_rpy="0 0 1.5708" />
  </link>

  <!-- Virtual Joint para fijar la base al suelo -->
  <joint name="virtual_joint" type="fixed">
        <parent link="world"/>
        <child link="g_base"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
    </joint>


  <xacro:m_link_mesh name="joint1" mesh_file="joint1.dae" origin_xyz="0.0 0 0" origin_rpy="0 0 -3.14159" />
  <xacro:m_link_mesh name="joint2" mesh_file="joint2.dae" origin_xyz="0.0 0 -0.06096" origin_rpy="0 0 -1.5708" />
  <xacro:m_link_mesh name="joint3" mesh_file="joint3.dae" origin_xyz="0.0 0 0.03256" origin_rpy="0 -1.5708 0" />
  <xacro:m_link_mesh name="joint4" mesh_file="joint4.dae" origin_xyz="0.0 0 0.03056" origin_rpy="0 -1.5708 0" />
  <xacro:m_link_mesh name="joint5" mesh_file="joint5.dae" origin_xyz="0.0 0 -0.03356" origin_rpy="-1.5708 0 0" />
  <xacro:m_link_mesh name="joint6" mesh_file="joint6.dae" origin_xyz="0 0 -0.038" origin_rpy="0 0 0" />
  <xacro:m_link_mesh name="joint6_flange" mesh_file="joint7.dae" origin_xyz="0 0 -0.012" origin_rpy="0 0 0" />

  <!-- Articulaciones del Brazo -->
  <joint name="g_base_to_joint1" type="fixed"><parent link="g_base"/><child link="joint1"/><origin xyz="0 0 0" rpy="0 0 0"/></joint>
  <joint name="joint2_to_joint1" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-2.9321" upper="2.9321" velocity="0.3"/><parent link="joint1"/><child link="joint2"/><origin xyz="0 0 0.13156" rpy="0 0 0"/></joint>
  <joint name="joint3_to_joint2" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-2.3561" upper="2.3561" velocity="0.3"/><parent link="joint2"/><child link="joint3"/><origin xyz="0 0 0" rpy="0 1.5708 -1.5708"/></joint>
  <joint name="joint4_to_joint3" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-2.6179" upper="2.6179" velocity="0.3"/><parent link="joint3"/><child link="joint4"/><origin xyz="-0.1104 0 0" rpy="0 0 0"/></joint>
  <joint name="joint5_to_joint4" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-2.5307" upper="2.5307" velocity="0.3"/><parent link="joint4"/><child link="joint5"/><origin xyz="-0.096 0 0.06462" rpy="0 0 -1.5708"/></joint>
  <joint name="joint6_to_joint5" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-2.8797" upper="2.8797" velocity="0.3"/><parent link="joint5"/><child link="joint6"/><origin xyz="0 -0.07318 0" rpy="1.5708 -1.5708 0"/></joint>
  <joint name="joint6output_to_joint6" type="revolute"><axis xyz="0 0 1"/><limit effort="1000.0" lower="-3.14" upper="3.14159" velocity="0.3"/><parent link="joint6"/><child link="joint6_flange"/><origin xyz="0 0.0456 0" rpy="-1.5708 0 0"/></joint>

  <!-- LLAMADA CONDICIONAL: Carga la pinza si use_gripper es true -->
  <xacro:if value="$(arg use_gripper)">
    <xacro:m_adaptative_gripper parent="joint6_flange" />
  </xacro:if>

 <!-- LLAMADA CONDICIONAL: Carga la camara si use_camera es true -->
  <xacro:if value="$(arg use_camera)">
    <xacro:rgb_camera parent="joint6" prefix="robot">
      <origin xyz="0.03 0 0.02" rpy="0 0 -${pi/2}"/>
    </xacro:rgb_camera>
  </xacro:if>

</robot>