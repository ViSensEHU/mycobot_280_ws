<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Macro para la Pinza Adaptativa -->
  <xacro:macro name="m_adaptative_gripper" params="parent">

    <!-- Enlace de conexión al brazo -->
    <joint name="joint6output_to_gripper_base" type="fixed">
      <parent link="${parent}"/>
      <child link="gripper_base"/>
      <origin xyz="0 0 0.034" rpy="1.579 0 0"/>  
    </joint>

    <!-- Links del Gripper -->
    <xacro:m_link_mesh name="gripper_base" mesh_file="gripper_base.dae" origin_xyz="0 0 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_left1" mesh_file="gripper_left1.dae" origin_xyz="0.039 -0.0133 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_left2" mesh_file="gripper_left2.dae" origin_xyz="0.005 -0.0195 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_left3" mesh_file="gripper_left3.dae" origin_xyz="0.012 0.0025 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_right1" mesh_file="gripper_right1.dae" origin_xyz="-0.039 -0.0133 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_right2" mesh_file="gripper_right2.dae" origin_xyz="-0.005 -0.0195 -0.012" origin_rpy="0 0 0" mass="0.001"/>
    <xacro:m_link_mesh name="gripper_right3" mesh_file="gripper_right3.dae" origin_xyz="-0.012 0.0025 -0.012" origin_rpy="0 0 0" mass="0.001"/>

    <!-- Articulaciones internas del Gripper -->
    <joint name="gripper_controllable_joint" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.74" upper="0.15" velocity="0"/>
      <parent link="gripper_base"/><child link="gripper_left3"/><origin xyz="-0.012 0.005 0" rpy="0 0 0"/> 
    </joint>

    <joint name="gripper_base_to_gripper_left2" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.8" upper="0.5" velocity="0"/>
      <parent link="gripper_base"/><child link="gripper_left2"/><origin xyz="-0.005 0.027 0" rpy="0 0 0"/> 
      <mimic joint="gripper_controllable_joint" multiplier="1.0" offset="0" />
    </joint>

    <joint name="gripper_left3_to_gripper_left1" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.5" upper="0.5" velocity="0"/>
      <parent link="gripper_left3"/><child link="gripper_left1"/><origin xyz="-0.027 0.016 0" rpy="0 0 0"/> 
      <mimic joint="gripper_controllable_joint" multiplier="-1.0" offset="0" />
    </joint>

    <joint name="gripper_base_to_gripper_right3" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.15" upper="0.7" velocity="0"/>
      <parent link="gripper_base"/><child link="gripper_right3"/><origin xyz="0.012 0.005 0" rpy="0 0 0"/> 
      <mimic joint="gripper_controllable_joint" multiplier="-1.0" offset="0" />
    </joint>

    <joint name="gripper_base_to_gripper_right2" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.5" upper="0.8" velocity="0"/>
      <parent link="gripper_base"/><child link="gripper_right2"/><origin xyz="0.005 0.027 0" rpy="0 0 0"/> 
      <mimic joint="gripper_controllable_joint" multiplier="-1.0" offset="0" />
    </joint>

    <joint name="gripper_right3_to_gripper_right1" type="revolute">
      <axis xyz="0 0 1"/><limit effort="1000.0" lower="-0.5" upper="0.5" velocity="0"/>
      <parent link="gripper_right3"/><child link="gripper_right1"/><origin xyz="0.027 0.016 0" rpy="0 0 0"/> 
      <mimic joint="gripper_controllable_joint" multiplier="1.0" offset="0" />
    </joint>


  <!-- Definición de ros2_control para el Gripper -->
    <!-- Articulación Maestra del Gripper -->

  <ros2_control name="GazeboSimSystemGripper" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>
      <joint name="gripper_controllable_joint">
        <command_interface name="position"/>
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity"/>
      </joint>
  </ros2_control>

  </xacro:macro>

</robot>